<script>
    async function lanzar() {
        const btn = document.getElementById('btn');
        const status = document.getElementById('status');
        btn.disabled = true;
        status.innerText = "Capturando IP...";

        try {
            // 1. Obtenemos tu IP real
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            const miIP = data.ip;

            // 2. La enviamos a tu buzón de Pipedream
            await fetch("https://eozxbiwyymdbb76.m.pipedream.net", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                // Enviamos 'ip_usuario', que es la "llave" que pusimos en Pipedream
                body: JSON.stringify({ ip_usuario: miIP }) 
            });

            status.innerHTML = "<b style='color:green'>¡IP Sincronizada! (" + miIP + ")</b><br>Espera 30 segundos a que GitHub actualice.";
        } catch (e) {
            status.innerText = "Error al sincronizar.";
            console.error(e);
        } finally {
            btn.disabled = false;
        }
    }
</script>
